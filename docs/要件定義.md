# チャットワークタスク自動生成ツール - 要件定義

## 1. プロジェクト概要

### プロジェクト名
**タスクBot**（仮称）

### 目的
Obsidianに保存されたチャットワークログから、チーム全員のタスクを自動抽出し、Webアプリで管理・Chatworkで通知する。

### 解決する課題
- 会話の中で発生したタスクが埋もれてしまう
- 誰が何をやるべきか把握しづらい

---

## 2. システム全体像

```
┌─────────────────────────────────────────────────────────────────┐
│                        タスクBot システム                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │  Obsidian   │───▶│  タスク抽出  │───▶│   Google    │         │
│  │ Chatworkログ│    │  (Claude AI) │    │ スプレッド   │         │
│  └─────────────┘    └─────────────┘    │   シート    │         │
│                                        │             │         │
│                                        │ ・未完了タスク│         │
│                                        │ ・完了タスク │         │
│                                        │ ・メンバー   │         │
│                                        └──────┬──────┘         │
│                                               │                 │
│                     ┌─────────────────────────┼─────────┐       │
│                     │                         │         │       │
│                     ▼                         ▼         ▼       │
│              ┌─────────────┐          ┌─────────────┐          │
│              │   Webアプリ  │          │  Chatwork   │          │
│              │  (Next.js)  │          │    通知     │          │
│              │             │          │  毎朝10時   │          │
│              │ ・タスク一覧 │          │             │          │
│              │ ・完了→移動  │          │ ・担当者別   │          │
│              │ ・担当者別   │          │ ・メンション │          │
│              └─────────────┘          └─────────────┘          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 機能要件

### 3.1 タスク抽出機能
| 項目 | 内容 |
|------|------|
| データソース | Obsidian `08_Chatworkログ` のMarkdownファイル |
| 抽出対象 | 「次アクション」「要対応」セクション |
| 抽出方法 | Claude AI でタスク判定（発言内容を除外） |
| 対象者 | チーム全員 |
| 実行タイミング | 毎朝10時（自動） + 手動実行可能 |

### 3.2 Webアプリ（タスク管理UI）
| 項目 | 内容 |
|------|------|
| フレームワーク | Next.js |
| 認証 | 2桁の番号（社内メンバー用、スプシで管理） |
| 表示形式 | リスト形式 |
| 利用者 | チーム全員 |
| 機能 | タスク一覧表示、完了/未完了切り替え、担当者フィルター |

### 3.3 Chatwork通知
| 項目 | 内容 |
|------|------|
| 通知先 | 専用ルーム（rid: 420216149） |
| 通知形式 | 担当者へのメンション付きメッセージ |
| 通知タイミング | 毎朝10時 |
| リマインダー | 期限超過タスクを再通知 |

### 3.4 データ管理
| 項目 | 内容 |
|------|------|
| 保存先 | Google スプレッドシート |
| シート構成 | 「未完了タスク」「完了タスク」「メンバー」 |
| 管理項目 | タスク内容、担当者、期限、完了状態、作成日 |
| 完了時 | タスク完了フラグ → 「完了タスク」シートに移動 |
| メンバー管理 | 2桁番号、名前、ChatworkIDをスプシで管理 |

---

## 4. 画面設計（Webアプリ）

### 4.1 ログイン画面
```
┌────────────────────────────────┐
│         タスクBot              │
│                                │
│    番号を入力してください       │
│    ┌──────────────────┐        │
│    │ ●●               │        │
│    └──────────────────┘        │
│         [ログイン]             │
│                                │
└────────────────────────────────┘
```

### 4.2 タスク一覧画面
```
┌────────────────────────────────────────────────────────┐
│ タスクBot                           [担当者▼] [更新]  │
├────────────────────────────────────────────────────────┤
│                                                        │
│ 📋 未完了タスク (15件)                                 │
│ ┌────────────────────────────────────────────────────┐ │
│ │ ☐ キャリアフォーカスに契約書を送る                  │ │
│ │   👤 安部直樹  📅 今日まで  📌 PGT案件相談         │ │
│ ├────────────────────────────────────────────────────┤ │
│ │ ☐ AGAスキンクリニックのコード発行                   │ │
│ │   👤 海野洵矢  📅 1/16  📌 KITEN × PG             │ │
│ ├────────────────────────────────────────────────────┤ │
│ │ ☐ メンズエミナルの記事確認                         │ │
│ │   👤 ピアラ町田  📅 週内  📌 国内案件              │ │
│ └────────────────────────────────────────────────────┘ │
│                                                        │
│ ✅ 完了タスク (3件)  [表示▼]                          │
│                                                        │
└────────────────────────────────────────────────────────┘
```

---

## 5. Chatwork通知メッセージ例

```
[タスク通知] 2026-01-15 10:00

━━━━━━━━━━━━━━━━━━━━
[To:674453] 安部直樹さん (3件)
━━━━━━━━━━━━━━━━━━━━
□ キャリアフォーカスに契約書を送る（📅 今日）
□ ミチガエル事業紹介の確認回答
□ AGAスキン移管MTGの日程調整

━━━━━━━━━━━━━━━━━━━━
[To:XXXXXX] 海野洵矢さん (2件)
━━━━━━━━━━━━━━━━━━━━
□ AGAスキンクリニックのコード発行
□ 楽器買取の最終件数報告

━━━━━━━━━━━━━━━━━━━━

📱 タスク管理: https://xxxxx.vercel.app
```

---

## 6. 技術スタック

| 領域 | 技術 |
|------|------|
| フロントエンド | Next.js 15, React 19, TypeScript, Tailwind CSS |
| バックエンド | Next.js API Routes |
| データベース | Google スプレッドシート（Google Sheets API） |
| 認証 | 2桁番号認証（スプシの「メンバー」シートで検証） |
| AI | Claude API (claude-3-haiku) |
| 外部連携 | Chatwork API, Google Sheets API |
| ホスティング | Vercel |
| 自動実行 | n8n / Cloud Scheduler |

---

## 7. データ構造（スプレッドシート）

### 「未完了タスク」シート
| 列 | 内容 |
|---|------|
| A | ID（自動採番） |
| B | タスク内容 |
| C | 担当者名 |
| D | 期限 |
| E | 抽出元ルーム |
| F | 抽出日 |
| G | 作成日時 |
| H | 通知済み日時 |

### 「完了タスク」シート
| 列 | 内容 |
|---|------|
| A〜H | 未完了タスクと同じ |
| I | 完了日時 |

### 「メンバー」シート
| 列 | 内容 |
|---|------|
| A | 2桁番号（ログイン用） |
| B | 名前 |
| C | Chatwork account_id |
| D | 名前の表記ゆれ（カンマ区切り） |

---

## 8. API設計

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/tasks` | GET | タスク一覧取得 |
| `/api/tasks` | POST | タスク追加（抽出実行） |
| `/api/tasks/[id]` | PATCH | タスク更新（完了等） |
| `/api/extract` | POST | ログからタスク抽出実行 |
| `/api/notify` | POST | Chatwork通知送信 |
| `/api/auth` | POST | PIN認証 |

---

## 9. 開発フェーズ

### Phase 1: 基盤構築 ✅ 完了
- [x] プロジェクト作成
- [x] ログパース機能
- [x] 基本的なタスク抽出

### Phase 2: Webアプリ
- [ ] Next.jsプロジェクト作成
- [ ] Google Sheets API設定
- [ ] スプレッドシート作成（未完了/完了/メンバー）
- [ ] 2桁番号認証
- [ ] タスク一覧画面
- [ ] 完了→完了シートに移動

### Phase 3: AI判定 + 通知
- [ ] Claude APIでタスク判定
- [ ] Chatwork通知機能
- [ ] メンバーのaccount_id設定

### Phase 4: 自動化
- [ ] 毎朝10時の自動実行
- [ ] 期限超過リマインダー
- [ ] Vercelデプロイ

---

## 10. 必要な情報（要収集）

| 項目 | 状態 |
|------|------|
| Chatwork APIトークン | 既存（環境変数） |
| Claude APIキー | 既存（環境変数） |
| Google Sheets API | サービスアカウント設定が必要 |
| スプレッドシートID | 新規作成 |
| チームメンバーのChatwork ID | スプシの「メンバー」シートに登録 |
| メンバーの2桁番号 | スプシの「メンバー」シートに登録 |

---

## 変更履歴
- 2026-01-15: 初版作成
- 2026-01-15: Webアプリ要件追加
